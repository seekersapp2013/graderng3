{"version":3,"file":"index.esm.js","sources":["../../src/popper/index.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Placement, Instance, createPopper } from '@popperjs/core';\n\nconst oppositeDirections = {\n  top: 'bottom',\n  bottom: 'top',\n  right: 'left',\n  left: 'right',\n};\n\ntype Direction = keyof typeof oppositeDirections;\n\nexport const getOppositePosition = (position: Direction) => oppositeDirections[position];\n\nconst splitPlacement = (placement: Placement) => placement.split('-') as Direction[];\n\nexport function getArrowStyles(placement: Placement, arrowSize: number): React.CSSProperties {\n  const [position] = splitPlacement(placement);\n  const oppositePosition = getOppositePosition(position);\n  if (!oppositePosition) return {};\n\n  return {\n    [oppositePosition]: `-${arrowSize / 2}px`,\n    width: arrowSize,\n    height: arrowSize,\n    position: 'absolute',\n    transform: 'rotate(45deg)',\n  };\n}\n\nconst isBrowser = typeof window !== 'undefined';\n\nconst useSafeLayoutEffect = isBrowser ? React.useLayoutEffect : React.useEffect;\n\nexport interface UsePopperProps {\n  gutter?: number;\n  placement?: Placement;\n  offset?: number;\n  preventOverflow?: boolean;\n  fixed?: boolean;\n  forceUpdate?: boolean;\n  flip?: boolean;\n  arrowSize?: number;\n  eventsEnabled?: boolean;\n}\n\nexport function usePopper(props: UsePopperProps) {\n  const {\n    placement: initialPlacement = 'bottom',\n    offset: offsetProp,\n    preventOverflow = true,\n    fixed = false,\n    forceUpdate = true,\n    flip = true,\n    arrowSize = 10,\n    gutter = arrowSize,\n    eventsEnabled = true,\n  } = props;\n\n  const popper = React.useRef<Instance | null>(null);\n  const referenceRef = React.useRef<HTMLButtonElement>(null);\n  const popoverRef = React.useRef<HTMLDivElement>(null);\n  const arrowRef = React.useRef<HTMLDivElement>(null);\n\n  const [originalPlacement, place] = React.useState(initialPlacement);\n  const [placement, setPlacement] = React.useState(initialPlacement);\n  const [offset] = React.useState(offsetProp || [0, gutter]);\n  const [popoverStyles, setPopoverStyles] = React.useState<React.CSSProperties>({});\n  const [arrowStyles, setArrowStyles] = React.useState<React.CSSProperties>({});\n\n  const update = React.useCallback(() => {\n    if (popper.current) {\n      popper.current.forceUpdate();\n      return true;\n    }\n    return false;\n  }, []);\n\n  useSafeLayoutEffect(() => {\n    if (referenceRef.current && popoverRef.current) {\n      popper.current = createPopper(referenceRef.current, popoverRef.current, {\n        placement: originalPlacement,\n        strategy: fixed ? 'fixed' : 'absolute',\n        modifiers: [\n          {\n            name: 'eventListener',\n            phase: 'write',\n            enabled: eventsEnabled,\n          },\n          {\n            name: 'applyStyles',\n            enabled: false,\n          },\n          {\n            name: 'flip',\n            enabled: flip,\n            options: { padding: 8 },\n          },\n          {\n            name: 'computeStyles',\n            options: { gpuAcceleration: false },\n          },\n          {\n            name: 'offset',\n            options: { offset },\n          },\n          {\n            name: 'preventOverflow',\n            enabled: preventOverflow,\n            options: {\n              tetherOffset: () => arrowRef.current?.clientWidth || 0,\n            },\n          },\n          {\n            name: 'arrow',\n            enabled: Boolean(arrowRef.current),\n            options: { element: arrowRef.current },\n          },\n          {\n            name: 'updateState',\n            phase: 'write',\n            enabled: true,\n            fn({ state }) {\n              setPlacement(state.placement);\n              setPopoverStyles(state.styles.popper as React.CSSProperties);\n              setArrowStyles(state.styles.arrow as React.CSSProperties);\n            },\n          },\n        ],\n      });\n    }\n    return () => {\n      if (popper.current) {\n        popper.current.destroy();\n        popper.current = null;\n      }\n    };\n  }, [originalPlacement, fixed, forceUpdate, flip, offset, preventOverflow]);\n\n  useSafeLayoutEffect(() => {\n    requestAnimationFrame(() => {\n      if (forceUpdate) {\n        popper.current?.forceUpdate();\n      }\n    });\n  }, [forceUpdate]);\n\n  const computedArrowStyles: React.CSSProperties = {\n    ...arrowStyles,\n    ...getArrowStyles(placement, arrowSize),\n  };\n\n  return {\n    popperInstance: popper.current,\n    reference: {\n      ref: referenceRef,\n    },\n    popper: {\n      ref: popoverRef,\n      style: popoverStyles,\n    },\n    arrow: {\n      ref: arrowRef,\n      style: computedArrowStyles,\n    },\n    update,\n    placement,\n    place,\n  };\n}\n\nexport type UsePopperReturn = ReturnType<typeof usePopper>;\n"],"names":["oppositeDirections","top","bottom","right","left","getOppositePosition","position","splitPlacement","placement","split","getArrowStyles","arrowSize","oppositePosition","width","height","transform","isBrowser","window","useSafeLayoutEffect","React","usePopper","props","initialPlacement","offsetProp","offset","preventOverflow","fixed","forceUpdate","flip","gutter","eventsEnabled","popper","referenceRef","popoverRef","arrowRef","originalPlacement","place","setPlacement","popoverStyles","setPopoverStyles","arrowStyles","setArrowStyles","update","current","createPopper","strategy","modifiers","name","phase","enabled","options","padding","gpuAcceleration","tetherOffset","clientWidth","Boolean","element","fn","state","styles","arrow","destroy","requestAnimationFrame","computedArrowStyles","popperInstance","reference","ref","style"],"mappings":"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"}