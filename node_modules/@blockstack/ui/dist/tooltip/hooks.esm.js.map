{"version":3,"file":"hooks.esm.js","sources":["../../src/tooltip/hooks.tsx"],"sourcesContent":["import * as React from 'react';\nimport { useRef, useCallback, useEffect } from 'react';\nimport { Placement } from '@popperjs/core';\n\nimport { useDisclosure, useEventListener, useId, useMergeRefs } from '../hooks';\nimport { usePopper, UsePopperProps } from '../popper';\nimport { callAllHandlers, mergeRefs, Dict } from '../utils';\nimport flushable from 'flushable';\n\nlet hideOperation: flushable.FlushableOperation;\nlet activeId: string | null = null;\n\nfunction show(fn: (isHidePending: boolean) => void, delay: number) {\n  // check if hide has not been executed\n  const isHidePending = hideOperation?.pending();\n\n  // immediately execute hide if it has not been executed\n  if (isHidePending) {\n    hideOperation.flush();\n  }\n\n  // setup the show operation using flushable\n  const showOperation = flushable(() => fn(isHidePending), isHidePending ? 0 : delay);\n\n  // return a function to cancel show() from executing\n  // in the case of multiple tooltips\n  return showOperation.cancel;\n}\n\nfunction hide(fn: (flushed: boolean) => void, delay: number) {\n  // setup the hide operation using flushable\n  hideOperation = flushable(flushed => fn(flushed), delay);\n\n  // return a function to cancel hide() from executing\n  return hideOperation.cancel;\n}\n\nexport interface UseTooltipProps {\n  /**\n   * Delay (in ms) before hiding the tooltip\n   * @default 200ms\n   */\n  hideDelay?: number;\n  /**\n   * Delay (in ms) before showing the tooltip\n   * @default 200ms\n   */\n  showDelay?: number;\n  /**\n   * If `true`, the tooltip will hide on click\n   */\n  hideOnClick?: boolean;\n  /**\n   * If `true`, the tooltip will hide while the mouse\n   * is down\n   */\n  hideOnMouseDown?: boolean;\n  /**\n   * Callback to run when the tooltip shows\n   */\n  onShow?(): void;\n  /**\n   * Callback to run when the tooltip hides\n   */\n  onHide?(): void;\n  /**\n   * The Popper.js placement of the tooltip\n   */\n  placement?: Placement;\n  /**\n   * Custom `id` to use in place of `uuid`\n   */\n  id?: string;\n  /**\n   * If `true`, the tooltip will be shown (in controlled mode)\n   */\n  isOpen?: boolean;\n  /**\n   * If `true`, the tooltip will be initially shown\n   */\n  defaultIsOpen?: boolean;\n  /**\n   * The size of the arrow in css units (numeric)\n   * @default 10 ( = 10px )\n   */\n  arrowSize?: UsePopperProps['arrowSize'];\n  /**\n   * The label, we check if it changes to refresh the position of the tooltip\n   */\n  label?: string;\n}\n\nexport function useTooltip(props: UseTooltipProps = {}) {\n  const {\n    showDelay = 200,\n    hideDelay = 200,\n    hideOnClick = false,\n    onShow,\n    onHide,\n    hideOnMouseDown,\n    placement,\n    id,\n    isOpen: isOpenProp,\n    defaultIsOpen,\n    arrowSize = 10,\n    label: _label,\n  } = props;\n\n  const [label, setLabel] = React.useState(_label);\n\n  const labelIsUpToDate = _label === label;\n\n  if (!labelIsUpToDate) setLabel(_label);\n\n  const { isOpen, onOpen: open, onClose: close } = useDisclosure({\n    isOpen: isOpenProp,\n    defaultIsOpen,\n    onOpen: onShow,\n    onClose: onHide,\n  });\n\n  const popper = usePopper({\n    forceUpdate: isOpen && labelIsUpToDate,\n    placement,\n    arrowSize,\n  });\n\n  const tooltipId = useId(id, 'tooltip');\n\n  const ref = useRef<any>(null);\n  const triggerRef = useMergeRefs(ref, popper.reference.ref);\n\n  const flushRef = useRef<Function>();\n\n  useEffect(() => {\n    return () => flushRef.current?.();\n  }, []);\n\n  const hideImmediately = useCallback(() => {\n    flushRef.current?.();\n    close();\n  }, [close]);\n\n  const onClick = useCallback(() => {\n    if (hideOnClick) {\n      hideImmediately();\n    }\n  }, [hideOnClick, hideImmediately]);\n\n  const onMouseDown = useCallback(() => {\n    if (hideOnMouseDown) {\n      hideImmediately();\n    }\n  }, [hideOnMouseDown, hideImmediately]);\n\n  const showTooltip = useCallback(() => {\n    flushRef.current?.();\n\n    if (tooltipId !== activeId) {\n      hideImmediately();\n    }\n\n    activeId = tooltipId;\n\n    if (!isOpen) {\n      flushRef.current = show(() => {\n        open();\n      }, showDelay);\n    }\n  }, [isOpen, showDelay, open, tooltipId, hideImmediately]);\n\n  const hideTooltip = useCallback(() => {\n    flushRef.current?.();\n    activeId = null;\n\n    if (isOpen) {\n      flushRef.current = hide(() => {\n        close();\n      }, hideDelay);\n    }\n  }, [isOpen, hideDelay, close]);\n\n  const onMouseOver = useCallback(\n    (event: React.MouseEvent) => {\n      const isSelf = event.target === (ref.current as HTMLElement);\n\n      if (isOpen && isSelf) {\n        return;\n      }\n\n      showTooltip();\n    },\n    [isOpen, showTooltip]\n  );\n\n  // A11y: Close the tooltip if user presses escape\n  const onKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (isOpen && event.key === 'Escape') {\n        hideImmediately();\n      }\n    },\n    [isOpen, hideImmediately]\n  );\n\n  useEventListener('keydown', onKeyDown);\n\n  return {\n    isOpen,\n    show: open,\n    hide: close,\n    placement: popper.placement,\n    getTriggerProps: (props: Dict = {}) => ({\n      ...props,\n      ref: mergeRefs(props.ref, triggerRef),\n      onMouseOut: callAllHandlers(props.onMouseOut, hideTooltip),\n      onMouseOver: callAllHandlers(props.onMouseOver, onMouseOver),\n      onClick: callAllHandlers(props.onClick, onClick),\n      onMouseDown: callAllHandlers(props.onMouseDown, onMouseDown),\n      onFocus: callAllHandlers(props.onFocus, showTooltip),\n      onBlur: callAllHandlers(props.onBlur, hideTooltip),\n      'aria-describedby': isOpen ? tooltipId : undefined,\n    }),\n    getTooltipProps: (props: Dict = {}) => ({\n      ...props,\n      id: tooltipId,\n      role: 'tooltip',\n      ref: mergeRefs(props.ref, popper.popper.ref),\n      style: { ...props.style, ...popper.popper.style },\n    }),\n    getArrowProps: (props: Dict = {}) => ({\n      ...props,\n      ref: mergeRefs(props.ref, popper.arrow.ref),\n      style: { ...props.style, ...popper.arrow.style },\n    }),\n  };\n}\n\nexport type UseTooltipReturn = ReturnType<typeof useTooltip>;\n"],"names":["hideOperation","activeId","show","fn","delay","isHidePending","pending","flush","showOperation","flushable","cancel","hide","flushed","useTooltip","props","showDelay","hideDelay","hideOnClick","onShow","onHide","hideOnMouseDown","placement","id","isOpenProp","isOpen","defaultIsOpen","arrowSize","_label","label","React","setLabel","labelIsUpToDate","useDisclosure","onOpen","onClose","open","close","popper","usePopper","forceUpdate","tooltipId","useId","ref","useRef","triggerRef","useMergeRefs","reference","flushRef","useEffect","current","hideImmediately","useCallback","onClick","onMouseDown","showTooltip","hideTooltip","onMouseOver","event","isSelf","target","onKeyDown","key","useEventListener","getTriggerProps","mergeRefs","onMouseOut","callAllHandlers","onFocus","onBlur","undefined","getTooltipProps","role","style","getArrowProps","arrow"],"mappings":"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"}